# å‡ºåŠ›HTML `<style>`ã‚¿ã‚°å†…ã®ã•ã‚‰ãªã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå‰Šæ¸›æ¡ˆ

**åˆ†ææ—¥**: 2025-12-31  
**å¯¾è±¡**: test-reset.htmlï¼ˆPaginatedãƒ¢ãƒ¼ãƒ‰å‡ºåŠ›ä¾‹ï¼‰

---

## ğŸ“Š ç¾çŠ¶åˆ†æ

### **ç¾åœ¨ã®CSSè¡Œæ•°**
- **ç·è¡Œæ•°**: ç´„457è¡Œï¼ˆè¡Œ80-536ï¼‰
- **AIã‚¬ã‚¤ãƒ‰æ–‡**: 70è¡Œï¼ˆè¡Œ8-78ï¼‰
- **åˆè¨ˆãƒ˜ãƒƒãƒ€ãƒ¼**: ç´„527è¡Œ

### **CSSå†…è¨³**

| ã‚«ãƒ†ã‚´ãƒª | è¡Œç¯„å›² | è¡Œæ•° | ç”¨é€” |
|---------|--------|------|------|
| CSSå¤‰æ•°å®šç¾© | 81-88 | 8è¡Œ | `:root` å¤‰æ•°ï¼ˆ**é‡è¤‡ã‚ã‚Š**ï¼‰ |
| åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ | 90-126 | 37è¡Œ | body, #pages-container, section.page |
| ãƒšãƒ¼ã‚¸ç•ªå· | 128-136 | 9è¡Œ | section.page::after |
| page-inner | 138-175 | 38è¡Œ | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ |
| æ®µè½ç•ªå· | 177-204 | 28è¡Œ | data-paraè¡¨ç¤ºã€éè¡¨ç¤ºåˆ¶å¾¡ |
| ç”»åƒã‚¹ã‚¿ã‚¤ãƒ« | 206-300 | 95è¡Œ | ç”»åƒã€ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã€ã‚µã‚¤ã‚º |
| è¡Œé–“ãƒ»ã‚¿ãƒ– | 302-314 | 13è¡Œ | line-height, inline-tab |
| ãƒ†ã‚­ã‚¹ãƒˆè£…é£¾ | 316-393 | 78è¡Œ | align, spacing, indent |
| **@media print** | **396-519** | **124è¡Œ** | **å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ«** |
| ç©ºè¡Œ | 520-536 | 17è¡Œ | ç„¡é§„ãªç©ºè¡Œ |

---

## ğŸ¯ å‰Šæ¸›å¯èƒ½ãªç®‡æ‰€ï¼ˆå„ªå…ˆé †ä½é †ï¼‰

### **å„ªå…ˆåº¦ HIGH: ã™ãã«å®Ÿè£…å¯èƒ½**

#### 1. **CSSå¤‰æ•°ã®é‡è¤‡å‰Šé™¤** âœ…
**å‰Šæ¸›å¯èƒ½**: 4è¡Œ

**å•é¡Œ**:
```css
:root { --page-margin: 17mm; }    /* è¡Œ81: buildFullHTML()ã§æŒ¿å…¥ */

:root {                            /* è¡Œ84-88: content.cssã‹ã‚‰ */
  --page-margin: 17mm;            /* â† é‡è¤‡ï¼ */
  --editor-font-family: inherit;
  --tab-width: 0px;
}
```

**è§£æ±ºç­–**:
```typescript
// aiMetadata.ts ã® buildFullHTML()
// ç¾åœ¨:
:root { --page-margin: ${pageMarginText}; }
${optimizedCss}

// ä¿®æ­£å¾Œ: optimizeCssForMode()ã§:rootã‚’å‰Šé™¤
:root { 
  --page-margin: ${pageMarginText}; 
  --editor-font-family: inherit;
  --tab-width: 0px;
}
${optimizedCss}  // :root { ... } ã¯å‰Šé™¤æ¸ˆã¿
```

**å‰Šæ¸›**: 4è¡Œ

---

#### 2. **ç©ºè¡Œã®å‰Šé™¤** âœ…
**å‰Šæ¸›å¯èƒ½**: 17è¡Œ

**å•é¡Œ**:
```css
}


    /* è¡Œ520-536: ç„¡é§„ãªç©ºè¡Œ17è¡Œ */


</style>
```

**è§£æ±ºç­–**:
```typescript
// optimizeCssForMode() ã§æœ€å¾Œã«è¿½åŠ 
cleanedCss = cleanedCss.replace(/\n\s*\n\s*\n+/g, '\n\n');  // 3è¡Œä»¥ä¸Šã®ç©ºè¡Œã‚’2è¡Œã«
cleanedCss = cleanedCss.trim();  // æœ«å°¾ã®ç©ºç™½å‰Šé™¤
```

**å‰Šæ¸›**: ç´„10-15è¡Œ

---

#### 3. **ã‚¨ãƒ‡ã‚£ã‚¿å°‚ç”¨ã‚¯ãƒ©ã‚¹ã®å‰Šé™¤** âœ…
**å‰Šæ¸›å¯èƒ½**: ç´„10-15è¡Œ

**å•é¡Œ**:
```css
.ProseMirror {        /* è¡Œ108-113: ã‚¨ãƒ‡ã‚£ã‚¿å°‚ç”¨ */
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
}

.ProseMirror-trailingBreak {  /* è¡Œ293-296, 516-518 */
  display: none;
}
```

**è§£æ±ºç­–**:
å‡ºåŠ›HTMLã«ã¯`.ProseMirror`ã‚¯ãƒ©ã‚¹ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€å‰Šé™¤å¯èƒ½ã€‚

```typescript
// optimizeCssForMode() ã«è¿½åŠ 
cleanedCss = cleanedCss.replace(/\.ProseMirror\s*\{[^}]*\}/g, '');
cleanedCss = cleanedCss.replace(/\.ProseMirror-[^{]*\{[^}]*\}/g, '');
```

**å‰Šæ¸›**: ç´„10è¡Œ

---

### **å„ªå…ˆåº¦ MEDIUM: å®Ÿè£…åŠ¹æœãŒé«˜ã„**

#### 4. **@media print ã‚¹ã‚¿ã‚¤ãƒ«ã®æ¡ä»¶ä»˜ãå‡ºåŠ›** â­
**å‰Šæ¸›å¯èƒ½**: 124è¡Œï¼ˆç´„27%ï¼‰

**å•é¡Œ**:
- å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ãŒ**124è¡Œ**ï¼ˆå…¨ä½“ã®27%ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå°åˆ·ã—ãªã„é™ã‚Šã€å®Œå…¨ã«ä¸è¦

**è§£æ±ºç­–**:

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ A: å®Œå…¨å‰Šé™¤ï¼ˆæ¨å¥¨ï¼‰**
```typescript
// buildFullHTML() ã«å¼•æ•°è¿½åŠ 
export function buildFullHTML(
    htmlContent: string,
    isWordMode: boolean,
    contentCss: string,
    pageMarginText: string,
    aiImageIndexHtml: string,
    includePrintStyles: boolean = true  // â† æ–°è¦è¿½åŠ 
): string {
    const optimizedCss = optimizeCssForMode(contentCss, isWordMode, includePrintStyles);
    // ...
}

// optimizeCssForMode() å†…
if (!includePrintStyles) {
    cleanedCss = cleanedCss.replace(/@media print\s*\{[\s\S]*?\n\}\s*$/gm, '');
}
```

**åŠ¹æœ**: 
- å‰Šæ¸›: 124è¡Œï¼ˆ27%ï¼‰
- å¿…è¦æ™‚ã®ã¿å«ã‚ã‚‹ï¼ˆè¨­å®šã§åˆ‡ã‚Šæ›¿ãˆï¼‰

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ B: CSS Minification**
```typescript
// å°åˆ·ã‚¹ã‚¿ã‚¤ãƒ«ã‚’minifyã—ã¦1è¡Œã«åœ§ç¸®
// å‰Šæ¸›: ç´„100è¡Œï¼ˆå¯èª­æ€§ã¯çŠ ç‰²ï¼‰
```

**å‰Šæ¸›**: æœ€å¤§124è¡Œ

---

#### 5. **æœªä½¿ç”¨ã®ã‚¨ãƒ‡ã‚£ã‚¿å°‚ç”¨ã‚»ãƒ¬ã‚¯ã‚¿** âœ…
**å‰Šæ¸›å¯èƒ½**: ç´„8è¡Œ

**å•é¡Œ**:
```css
body.hide-page-numbers section.page::after { ... }  /* è¡Œ197-199 */
body.hide-para-numbers .page-inner [data-para]::before { ... }  /* è¡Œ201-204 */
```

ã“ã‚Œã‚‰ã¯**ã‚¨ãƒ‡ã‚£ã‚¿å†…ã§ã®ã¿ä½¿ç”¨**ã•ã‚Œã€å‡ºåŠ›HTMLã«ã¯ä¸è¦ã€‚

**è§£æ±ºç­–**:
```typescript
// optimizeCssForMode() ã«è¿½åŠ 
cleanedCss = cleanedCss.replace(/body\.hide-[^{]*\{[^}]*\}/g, '');
```

**å‰Šæ¸›**: 8è¡Œ

---

#### 6. **CSSçŸ­ç¸®è¨˜æ³•ã®é©ç”¨** âœ…
**å‰Šæ¸›å¯èƒ½**: ç´„20-30è¡Œ

**ä¾‹**:
```css
/* ç¾åœ¨ï¼ˆ4è¡Œï¼‰ */
.page-inner .indent-1 {
  padding-left: 36pt;
}

/* çŸ­ç¸®å¾Œï¼ˆ1è¡Œï¼‰ */
.page-inner .indent-1{padding-left:36pt}

/* ã¾ãŸã¯è¤‡æ•°ã¾ã¨ã‚ã‚‹ */
.page-inner .indent-1{padding-left:36pt}
.page-inner .indent-2{padding-left:72pt}
.page-inner .indent-3{padding-left:108pt}
.page-inner .indent-4{padding-left:144pt}
.page-inner .indent-5{padding-left:180pt}
```

**å®Ÿè£…**:
CSS Minifierã‚’ä½¿ç”¨ï¼ˆæ”¹è¡Œãƒ»ç©ºç™½å‰Šé™¤ï¼‰

**å‰Šæ¸›**: ç´„20-30è¡Œï¼ˆå¯èª­æ€§ã¯çŠ ç‰²ï¼‰

---

### **å„ªå…ˆåº¦ LOW: å°†æ¥çš„ãªæ¤œè¨**

#### 7. **æœªä½¿ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã®å‹•çš„æ¤œå‡º**
**å‰Šæ¸›å¯èƒ½**: ä¸æ˜ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…å®¹ã«ã‚ˆã‚‹ï¼‰

- å®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã®ã¿ã‚’å‡ºåŠ›
- PurgeCSSã®ã‚ˆã†ãªä»•çµ„ã¿
- å®Ÿè£…ã‚³ã‚¹ãƒˆé«˜

---

## ğŸ“ˆ å‰Šæ¸›åŠ¹æœã®ã¾ã¨ã‚

### **å³åº§ã«å®Ÿè£…å¯èƒ½ï¼ˆå„ªå…ˆåº¦ HIGHï¼‰**

| æœ€é©åŒ–é …ç›® | å‰Šæ¸›è¡Œæ•° | å®Ÿè£…é›£æ˜“åº¦ | åŠ¹æœ |
|-----------|---------|-----------|------|
| 1. CSSå¤‰æ•°é‡è¤‡å‰Šé™¤ | 4è¡Œ | â­ ç°¡å˜ | å° |
| 2. ç©ºè¡Œå‰Šé™¤ | 10-15è¡Œ | â­ ç°¡å˜ | å° |
| 3. ã‚¨ãƒ‡ã‚£ã‚¿å°‚ç”¨ã‚¯ãƒ©ã‚¹å‰Šé™¤ | 10è¡Œ | â­â­ æ™®é€š | å° |
| **åˆè¨ˆï¼ˆå„ªå…ˆåº¦HIGHï¼‰** | **24-29è¡Œ** | - | **ç´„5%å‰Šæ¸›** |

### **åŠ¹æœçš„ãªæœ€é©åŒ–ï¼ˆå„ªå…ˆåº¦ MEDIUMï¼‰**

| æœ€é©åŒ–é …ç›® | å‰Šæ¸›è¡Œæ•° | å®Ÿè£…é›£æ˜“åº¦ | åŠ¹æœ |
|-----------|---------|-----------|------|
| 4. @media printå‰Šé™¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ | 124è¡Œ | â­â­ æ™®é€š | å¤§ |
| 5. æœªä½¿ç”¨ã‚¨ãƒ‡ã‚£ã‚¿ã‚»ãƒ¬ã‚¯ã‚¿å‰Šé™¤ | 8è¡Œ | â­â­ æ™®é€š | å° |
| 6. CSS Minification | 20-30è¡Œ | â­â­â­ ã‚„ã‚„é›£ | ä¸­ |
| **åˆè¨ˆï¼ˆå„ªå…ˆåº¦MEDIUMï¼‰** | **152-162è¡Œ** | - | **ç´„33%å‰Šæ¸›** |

### **æœ€çµ‚çš„ãªå‰Šæ¸›ç›®æ¨™**

```
ç¾çŠ¶: 457è¡Œï¼ˆCSSéƒ¨åˆ†ã®ã¿ï¼‰

ã€æ§ãˆã‚ã‚·ãƒŠãƒªã‚ªã€‘ï¼ˆå„ªå…ˆåº¦HIGH ã®ã¿å®Ÿè£…ï¼‰
  å‰Šæ¸›: 24-29è¡Œ
  çµæœ: ç´„428-433è¡Œ
  å‰Šæ¸›ç‡: 5.2-6.3%

ã€ç©æ¥µçš„ã‚·ãƒŠãƒªã‚ªã€‘ï¼ˆå„ªå…ˆåº¦MEDIUM ã¾ã§å®Ÿè£…ï¼‰
  å‰Šæ¸›: 176-191è¡Œ
  çµæœ: ç´„266-281è¡Œ
  å‰Šæ¸›ç‡: 38.5-41.8%

ã€æœ€å¤§ã‚·ãƒŠãƒªã‚ªã€‘ï¼ˆprintå‰Šé™¤ + Minificationï¼‰
  å‰Šæ¸›: ç´„200è¡Œ
  çµæœ: ç´„257è¡Œ
  å‰Šæ¸›ç‡: 43.8%
```

---

## ğŸ’¡ æ¨å¥¨å®Ÿè£…ãƒ—ãƒ©ãƒ³

### **ãƒ•ã‚§ãƒ¼ã‚º3A: ã™ãã«å®Ÿè£…ï¼ˆ5åˆ†ï¼‰**

1. âœ… CSSå¤‰æ•°ã®é‡è¤‡å‰Šé™¤ï¼ˆ4è¡Œï¼‰
2. âœ… ç©ºè¡Œã®å‰Šé™¤ï¼ˆ10-15è¡Œï¼‰
3. âœ… ã‚¨ãƒ‡ã‚£ã‚¿å°‚ç”¨ã‚¯ãƒ©ã‚¹å‰Šé™¤ï¼ˆ10è¡Œï¼‰

**åˆè¨ˆå‰Šæ¸›**: 24-29è¡Œï¼ˆ5-6%ï¼‰

### **ãƒ•ã‚§ãƒ¼ã‚º3B: åŠ¹æœçš„ãªæœ€é©åŒ–ï¼ˆ15åˆ†ï¼‰**

4. âœ… æœªä½¿ç”¨ã‚¨ãƒ‡ã‚£ã‚¿ã‚»ãƒ¬ã‚¯ã‚¿å‰Šé™¤ï¼ˆ8è¡Œï¼‰
5. âš ï¸ @media print ã®æ¡ä»¶ä»˜ãå‡ºåŠ›ï¼ˆ124è¡Œï¼‰
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å«ã‚ã‚‹
   - è¨­å®šã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«

**åˆè¨ˆå‰Šæ¸›**: 132è¡Œï¼ˆ28.9%ï¼‰

### **ãƒ•ã‚§ãƒ¼ã‚º3C: ã•ã‚‰ãªã‚‹æœ€é©åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**

6. âš ï¸ CSS Minificationï¼ˆ20-30è¡Œï¼‰
   - å¯èª­æ€§ãŒçŠ ç‰²ã«ãªã‚‹
   - ãƒ‡ãƒãƒƒã‚°ãŒå›°é›£
   - æ¨å¥¨åº¦: ä½

---

## ğŸ“‹ å®Ÿè£…ã‚³ãƒ¼ãƒ‰ä¾‹

### **optimizeCssForMode() ã®æ‹¡å¼µç‰ˆ**

```typescript
function optimizeCssForMode(
    contentCss: string, 
    isWordMode: boolean,
    options: {
        includePrintStyles?: boolean;
        minify?: boolean;
    } = {}
): string {
    const { includePrintStyles = true, minify = false } = options;
    
    // 1. ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤
    let cleanedCss = contentCss.replace(/\/\*[\s\S]*?\*\//g, '');
    
    // 2. CSSå¤‰æ•°ã®é‡è¤‡ã‚’å‰Šé™¤ï¼ˆcontent.cssã®:rootã‚’å‰Šé™¤ï¼‰
    cleanedCss = cleanedCss.replace(/:root\s*\{[^}]*\}/g, '');
    
    // 3. ã‚¨ãƒ‡ã‚£ã‚¿å°‚ç”¨ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
    cleanedCss = cleanedCss.replace(/\.ProseMirror(?:-[a-zA-Z]+)?\s*\{[^}]*\}/g, '');
    cleanedCss = cleanedCss.replace(/body\.hide-[^{]*\{[^}]*\}/g, '');
    
    // 4. ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®æœ€é©åŒ–
    if (isWordMode) {
        cleanedCss = cleanedCss.replace(/section\.page::after\s*\{[^}]*\}/g, '');
        cleanedCss = cleanedCss.replace(/section\.page\s*\{...\}/g, '...');
    } else {
        cleanedCss = cleanedCss.replace(/body\.mode-word[^{]*\{[^}]*\}/g, '');
    }
    
    // 5. @media print ã®æ¡ä»¶ä»˜ãå‰Šé™¤
    if (!includePrintStyles) {
        cleanedCss = cleanedCss.replace(/@media print\s*\{[\s\S]*?\n\}\s*$/m, '');
    }
    
    // 6. ç©ºè¡Œã®å‰Šé™¤
    cleanedCss = cleanedCss.replace(/\n\s*\n\s*\n+/g, '\n\n');
    cleanedCss = cleanedCss.trim();
    
    // 7. Minificationï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if (minify) {
        cleanedCss = cleanedCss.replace(/\s+/g, ' ');
        cleanedCss = cleanedCss.replace(/\s*{\s*/g, '{');
        cleanedCss = cleanedCss.replace(/\s*}\s*/g, '}');
        cleanedCss = cleanedCss.replace(/\s*:\s*/g, ':');
        cleanedCss = cleanedCss.replace(/\s*;\s*/g, ';');
    }
    
    return cleanedCss;
}
```

---

## ğŸ‰ çµè«–

### **æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**

1. **å³åº§ã«å®Ÿè£…**: ãƒ•ã‚§ãƒ¼ã‚º3Aï¼ˆ24-29è¡Œå‰Šæ¸›ã€5-6%ï¼‰
2. **ä»»æ„å®Ÿè£…**: ãƒ•ã‚§ãƒ¼ã‚º3Bï¼ˆ@media printæ¡ä»¶ä»˜ãã€+124è¡Œï¼‰
3. **éæ¨å¥¨**: CSS Minificationï¼ˆå¯èª­æ€§çŠ ç‰²ï¼‰

### **æœ€çµ‚çš„ãªå‰Šæ¸›åŠ¹æœ**

```
ã€ä¿å®ˆçš„ã€‘ãƒ•ã‚§ãƒ¼ã‚º3A ã®ã¿
  åˆæœŸ:    720è¡Œï¼ˆAIã‚¬ã‚¤ãƒ‰ + CSSï¼‰
  ãƒ•ã‚§ãƒ¼ã‚º1: 554è¡Œï¼ˆ23%å‰Šæ¸›ï¼‰
  ãƒ•ã‚§ãƒ¼ã‚º2: 522-524è¡Œï¼ˆ27.5%å‰Šæ¸›ï¼‰
  ãƒ•ã‚§ãƒ¼ã‚º3A: 498-500è¡Œï¼ˆ30.6%å‰Šæ¸›ï¼‰ â† NEW!

ã€ç©æ¥µçš„ã€‘ãƒ•ã‚§ãƒ¼ã‚º3A + 3Bï¼ˆprintå‰Šé™¤ï¼‰
  ãƒ•ã‚§ãƒ¼ã‚º3B: 374-376è¡Œï¼ˆ48%å‰Šæ¸›ï¼‰ â† NEW!
```

---

**ä½œæˆæ—¥**: 2025-12-31  
**åˆ†æå¯¾è±¡**: test-reset.html  
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ãƒ•ã‚§ãƒ¼ã‚º3Aã®å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰
