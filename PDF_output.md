## 概要
これは、解決困難な要件を効率的に解決するためのファイルである。要件に関する重要事項を随時追記修正することで、AIが状況を動的に把握しやすくするとともに、他のモデルも即座に状況を把握できるようにする。

内容は以下の通りとする。
1.未解決要件、2.未解決要件に関するコード変更履歴（毎回、分析結果・方針・変更内容を詳細に記述する）3.分析中に気づいた重要ポイント（試してだめだったこと、仮設、制約条件等...）、4.解決済み要件とその解決方法、5.要件に関連する全ファイルのファイル構成、6.要件に関連する技術スタック、7.要件に関する機能の動作原理（依存関係含む）

## ワークフロー

### 現状把握と分析
まず、1を確認して未解決要件を把握する。
その後、2～7を参考にしつつ、コードベースを分析して、現状の問題点を考える。
同時に、3を更新する。

### 5～7の更新
分析を踏まえて、5～7を更新する。
***常に、最新の要件に関連する記述を行い、最新の要件に関係のない記述は削除すること。***

### コード編集作業
次に、実際に要件を満たすためにコーディングを行う。途中、適宜3を更新する。

### 作業終了後
作業後は、ユーザーから、フィードバックを受けたのち、ユーザーの指示に従って、1,4を更新する。
***勝手に1,4を編集しないこと。***

----------------------------------------
# 以下、AIが自動的に更新する部分
----------------------------------------

## 1. 未解決要件
・現在UIメニューからのPDF出力は可能だが、PDF出力時に、A4領域以外もふくまれてしまう。
・PDF出力時に、A4領域のみを出力するように修正する。
・テキストは選択可能な形式で出力する。
→**OK**

・(新たな要件)2ページしかないのに、空の3ページ目が出力されてしまう。→解決したい。

**v1では実現しているため、積極的にv1を参考にすること。**

## 2. 未解決要件に関するコード変更履歴

### 2025-12-29 分析・修正
- **分析**: V3エディタにおいて`window.print()`を実行した際、ツールバーやサイドバーなどのReact UIが含まれてしまう原因は、`@media print`スタイルが不足しているためであった。また、エディタContainerの`overflow: hidden`や`height: 100vh`が有効なままだと、1ページ目しか出力されない問題が発生する。
- **方針**: V1の実装（`src/v1/styles/ui.css`）を参考に、印刷時に不要なUI要素を`display: none`で隠し、レイアウトを印刷フローに合わせてリセットする。
- **変更内容**:
    - `src/v2/app/App.tsx`: ツールバー(`id="toolbar"`)、サイドバー(`id="page-navigator"`)、メイン領域(`id="pages-container"`)にIDを付与。
    - `src/v2/styles/content.css`: `@media print`セクションを全面的に強化し、UI要素の非表示化、レイアウトのリセット、A4サイズの固定、テキスト選択の保証などを実装。

## 3. 分析中に気づいた重要ポイント
- **ズームの影響**: エディタ内で設定している`zoom`プロパティが印刷時にも適用されると、解像度やレイアウトが崩れる可能性があるため、`zoom: 1 !important`でリセットする必要がある。
- **Radix UI/Sonner**: ツールバー以外にも、トースト通知(`sonner`)やRadix UIのメニュー、ダイアログなどが印刷時に残らないよう、属性セレクタ(`[role="menu"]`等)での指定が有効。
- **ページ区切り**: `break-after: page;` を `section.page` に適用することで、ブラウザの印刷機能において正確なページ分割が可能。

## 4. 解決済み要件とその解決方法
（作業完了後のユーザー確認待ち）

## 5. 要件に関連する全ファイルのファイル構成
- `src/v2/app/App.tsx`: UIの全体構造。
- `src/v2/styles/content.css`: 印刷用のスタイル定義。
- `src/v2/components/features/Toolbar.tsx`: 印刷ボタンを含むツールバー。
- `src/v2/components/common/toolbar/FileMenu.tsx`: `window.print()`を呼び出す場所。

## 6. 要件に関連する技術スタック
- React / Tiptap
- Tailwind CSS (レイアウト)
- CSS `@media print`
- CSS Paged Media (`@page`)

## 7. 要件に関する機能の動作原理
1. ユーザーが「ファイル」メニューから「PDFとして出力」を選択。
2. `window.print()` が発火。
3. ブラウザが印刷用のレンダリングを開始。
4. `@media print` スタイルが適用される：
    - エディタ外側のUI（ツールバー等）が `display: none` になる。
    - `body` やコンテナのスクロール制限が解除され、`overflow: visible` になる。
    - 各 `section.page` 要素がA4サイズで固定され、ページごとに改ページされる。
    - テキスト選択レイヤーが前面に来るよう調整され、PDFリーダーでの選択が可能になる。


